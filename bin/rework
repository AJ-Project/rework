#!/usr/bin/env node

/**
 * Module dependencies.
 */

var program = require('commander')
  , rework = require('..');

// options

program
  .option('-v, --vendors <prefixes>', 'use vendor <prefixes>', list)
  .option('-p, --prefix <prop>', 'prefix occurrances of <prop>')
  .parse(process.argv);

// require prefixes

if (!program.vendors) throw new Error('--vendors required');

// vendor prefixes

var vendors = program.vendors.map(function(name){
  return '-' + name + '-';
});

// comma list

function list(str) {
  return str.split(/ *, */);
}

// read from stdin

var css = '';
process.stdin.setEncoding('utf8');
process.stdin.on('data', function(chunk){ css += chunk; });
process.stdin.on('end', apply).resume();

// apply transformations

function apply() {
  var style = rework(css);
  if (program.prefix) style.prefix(program.prefix, vendors);
  process.stdout.write(style.toString());
}